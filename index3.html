<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>گردونه شانس</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'IRANSans', 'Tahoma', sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .box {
            background: white;
            max-width: 420px;
            width: 100%;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            text-align: center;
        }
        .header {
            background: #4f46e5;
            color: white;
            padding: 30px 20px;
        }
        .header h1 {
            font-size: 26px;
            margin-bottom: 8px;
        }
        .header p {
            font-size: 15px;
            opacity: 0.9;
        }
        .content {
            padding: 40px 30px;
        }
        .wheel-container {
            position: relative;
            margin: 0 auto 35px;
            width: 300px;
            height: 300px;
        }
        #wheel {
            width: 100%;
            height: 100%;
            transition: transform 6s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .pointer {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #dc2626;
            z-index: 10;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(79,70,229,0.3);
            transition: 0.3s;
        }
        button:hover { transform: translateY(-3px); }
        button:disabled {
            background: #94a3b8;
            transform: none;
            cursor: not-allowed;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f0fdf4;
            border: 2px solid #22c55e;
            border-radius: 16px;
            font-size: 20px;
            font-weight: bold;
            color: #166534;
            display: none;
        }
        .admin-link {
            margin-top: 30px;
            font-size: 13px;
            color: #64748b;
        }
        .admin-link a { color: #4f46e5; text-decoration: underline; }

        /* پنل مدیریت */
        #adminPanel {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }
        .admin-box {
            background: white;
            padding: 30px;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .prize-item {
            margin-bottom: 18px;
            padding: 14px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        .prize-item label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #1e293b;
        }
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 16px;
        }
        #totalChance {
            text-align: center;
            font-weight: bold;
            margin: 20px 0;
            font-size: 18px;
        }
    </style>
    <link href="https://cdn.fontcdn.ir/Font/Persian/IRANSans/IRANSans.css" rel="stylesheet">
</head>
<body>

    <div class="box">
        <div class="header">
            <h1>گردونه شانس روزانه</h1>
            <p>هر روز یکبار شانس خودت رو امتحان کن</p>
        </div>
        <div class="content">
            <div class="wheel-container">
                <div class="pointer"></div>
                <canvas id="wheel" width="300" height="300"></canvas>
            </div>

            <button id="spinBtn">چرخاندن گردونه</button>

            <div class="result" id="result">
                تبریک! شما برنده شدید:<br>
                <span id="prize" style="font-size:24px; color:#22c55e;"></span>
            </div>

            <div class="admin-link">
                <small><a href="#" id="adminLink">ورود مدیر</a></small>
            </div>
        </div>
    </div>

    <!-- پنل مدیریت -->
    <div id="adminPanel">
        <div class="admin-box">
            <h2 style="margin-bottom:25px; color:#4f46e5;">پنل مدیریت شانس‌ها</h2>
            <div style="text-align:center;margin-bottom:20px;">
                <input type="password" id="adminPass" placeholder="رمز عبور" maxlength="6" style="padding:12px;width:180px;border-radius:8px;border:1px solid #ccc;font-size:18px;text-align:center;">
                <button onclick="loginAdmin()" style="padding:12px 20px;margin-top:10px;">ورود</button>
            </div>
            <div id="adminContent" style="display:none;">
                <p style="margin-bottom:20px; color:#64748b;">شانس هر جایزه رو به درصد وارد کنید (جمع باید ۱۰۰ باشد)</p>
                <div id="prizesList"></div>
                <div id="totalChance">جمع شانس‌ها: ۰٪</div>
                <div style="text-align:center;margin-top:25px;">
                    <button onclick="saveChances()" style="background:#22c55e;padding:12px 30px;border-radius:50px;color:white;">ذخیره</button>
                    <button onclick="closeAdmin()" style="background:#ef4444;padding:12px 30px;border-radius:50px;color:white;margin-right:10px;">بستن</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script>
        // جایزه‌ها (شانس واقعی فقط مدیر می‌دونه)
        let prizes = [
            {text: "۵۰٪ تخفیف ادمین طراح", chance: 20},
            {text: "۴۰٪ تخفیف هوش مصنوعی", chance: 20},
            {text: "۷۰٪ تخفیف استوری موشن", chance: 15},
            {text: "اکانت ۱ ماهه کپ‌کات", chance: 15},
            {text: "۱ ساعت مشاوره رایگان", chance: 15},
            {text: "۶۰٪ تخفیف هر دوره", chance: 10},
            {text: "پک آیکون سه بعدی", chance: 4},
            {text: "۳۰۰ هزار تومان نقدی!", chance: 1}
        ];

        const colors = ["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#c77dff"];
        const canvas = document.getElementById("wheel");
        const ctx = canvas.getContext("2d");

        // بارگذاری شانس‌ها از localStorage
        const saved = localStorage.getItem("wheel_prizes_v2");
        if (saved) prizes = JSON.parse(saved);

        const segmentCount = prizes.length;
        const segmentAngle = (2 * Math.PI) / segmentCount;

        function drawWheel() {
            ctx.clearRect(0, 0, 300, 300);
            prizes.forEach((prize, i) => {
                const startAngle = i * segmentAngle;
                const endAngle = startAngle + segmentAngle;

                // بخش رنگی
                ctx.beginPath();
                ctx.moveTo(150, 150);
                ctx.arc(150, 150, 140, startAngle, endAngle);
                ctx.fillStyle = colors[i];
                ctx.fill();
                ctx.strokeStyle = "white";
                ctx.lineWidth = 4;
                ctx.stroke();

                // متن (همه بخش‌ها اندازه یکسان به نظر می‌رسن)
                ctx.save();
                ctx.translate(150, 150);
                ctx.rotate(startAngle + segmentAngle / 2);
                ctx.textAlign = "center";
                ctx.fillStyle = "white";
                ctx.strokeStyle = "black";
                ctx.lineWidth = 3;
                ctx.font = "bold 13px IRANSans";

                const words = prize.text.split(" ");
                if (words.length > 3) {
                    ctx.strokeText(words.slice(0,2).join(" "), 85, -8);
                    ctx.fillText(words.slice(0,2).join(" "), 85, -8);
                    ctx.strokeText(words.slice(2).join(" "), 85, 12);
                    ctx.fillText(words.slice(2).join(" "), 85, 12);
                } else {
                    ctx.strokeText(prize.text, 85, 5);
                    ctx.fillText(prize.text, 85, 5);
                }
                ctx.restore();
            });

            // مرکز گردونه
            ctx.beginPath();
            ctx.arc(150, 150, 30, 0, Math.PI * 2);
            ctx.fillStyle = "#1e293b";
            ctx.fill();
            ctx.strokeStyle = "white";
            ctx.lineWidth = 5;
            ctx.stroke();
        }

        function spin() {
            const today = new Date().toDateString();
            if (localStorage.getItem("last_spin") === today) {
                alert("شما امروز قبلاً چرخوندید! فردا دوباره امتحان کنید.");
                return;
            }

            document.getElementById("spinBtn").disabled = true;
            document.getElementById("spinBtn").textContent = "در حال چرخش...";

            const spinDeg = Math.floor(Math.random() * 3600) + 1800;
            canvas.style.transform = `rotate(${spinDeg}deg)`;

            // انتخاب برنده بر اساس شانس واقعی
            const rand = Math.random() * 100;
            let sum = 0;
            let winner = 0;
            for (let i = 0; i < prizes.length; i++) {
                sum += prizes[i].chance;
                if (rand <= sum) { winner = i; break; }
            }

            setTimeout(() => {
                document.getElementById("result").style.display = "block";
                document.getElementById("prize").textContent = prizes[winner].text;
                localStorage.setItem("last_spin", today);
                document.getElementById("spinBtn").textContent = "امروز چرخوندی!";
                confetti({ particleCount: 180, spread: 70, origin: { y: 0.6 } });
            }, 6500);
        }

        // چک کردن چرخش امروز
        if (localStorage.getItem("last_spin") === new Date().toDateString()) {
            document.getElementById("spinBtn").textContent = "امروز چرخوندی!";
            document.getElementById("spinBtn").disabled = true;
        }

        document.getElementById("spinBtn").onclick = spin;
        document.getElementById("adminLink").onclick = (e) => {
            e.preventDefault();
            document.getElementById("adminPanel").style.display = "flex";
        };

        window.loginAdmin = () => {
            if (document.getElementById("adminPass").value === "107780") {
                document.querySelector(".admin-box > div").style.display = "none";
                document.getElementById("adminContent").style.display = "block";
                loadAdmin();
            } else {
                alert("رمز اشتباه است!");
            }
        };

        function loadAdmin() {
            const container = document.getElementById("prizesList");
            container.innerHTML = "";
            prizes.forEach((p, i) => {
                container.innerHTML += `
                    <div class="prize-item">
                        <label>${p.text}</label>
                        <input type="number" min="0" max="100" value="${p.chance}" data-index="${i}">
                    </div>`;
            });
            updateTotal();
            container.oninput = updateTotal;
        }

        function updateTotal() {
            let total = 0;
            document.querySelectorAll("#prizesList input").forEach(el => {
                total += parseInt(el.value) || 0;
            });
            document.getElementById("totalChance").textContent = `جمع شانس‌ها: ${total}٪`;
            document.getElementById("totalChance").style.color = total === 100 ? "#22c55e" : "#dc2626";
        }

        window.saveChances = () => {
            let total = 0;
            const inputs = document.querySelectorAll("#prizesList input");
            inputs.forEach(inp => {
                const i = inp.dataset.index;
                const val = parseInt(inp.value) || 0;
                prizes[i].chance = val;
                total += val;
            });
            if (total !== 100) {
                alert("جمع شانس‌ها باید دقیقاً ۱۰۰ باشد!");
                return;
            }
            localStorage.setItem("wheel_prizes_v2", JSON.stringify(prizes));
            alert("تنظیمات با موفقیت ذخیره شد!");
            drawWheel();
        };

        window.closeAdmin = () => {
            document.getElementById("adminPanel").style.display = "none";
            location.reload();
        };

        drawWheel();
    </script>
</body>
</html>