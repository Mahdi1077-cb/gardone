<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>گردونه شانس روزانه</title>
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --success: #10b981;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Vazirmatn', 'Tahoma', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text);
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: var(--card);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            text-align: center;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .content {
            padding: 30px 25px;
            text-align: center;
        }

        input[type="tel"] {
            width: 100%;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 18px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        input[type="tel"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .wheel-container {
            position: relative;
            margin: 40px auto;
            width: 300px;
            height: 300px;
        }

        #wheel {
            width: 100%;
            height: 100%;
            transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }

        .pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #dc2626;
            z-index: 10;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }

        button {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
            transition: all 0.3s;
            margin-top: 20px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background: #ecfdf5;
            border: 2px solid #10b981;
            border-radius: 16px;
            font-size: 20px;
            font-weight: bold;
            color: #065f46;
            display: none;
        }

        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        @media (max-width: 480px) {
            .wheel-container {
                width: 260px;
                height: 260px;
            }
            .header h1 { font-size: 24px; }
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/vazirmatn@33.0.0/Vazirmatn-font-face.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>گردونه شانس روزانه</h1>
            <p>شماره‌ت رو وارد کن و هر روز یه شانس ببر!</p>
        </div>

        <div class="content">
            <input type="tel" id="phone" placeholder="09xxxxxxxxx" maxlength="11">

            <div class="wheel-container">
                <div class="pointer"></div>
                <canvas id="wheel" width="300" height="300"></canvas>
            </div>

            <button id="spinBtn" disabled>چرخاندن گردونه</button>

            <div class="result" id="result">
                تبریک! شما برنده شدید: <span id="prize"></span>
            </div>
        </div>
    </div>

    <div class="confetti" id="confetti"></div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        const prizes = [
            "۵۰٪ تخفیف دوره ادمین طراح",
            "۴۰٪ تخفیف دوره هوش مصنوعی",
            "۷۰٪ تخفیف دوره استوری موشن",
            "اکانت یک ماهه کپ‌کات",
            "۱ ساعت مشاوره رایگان",
            "۶۰٪ تخفیف روی هر دوره",
            "پک آیکون‌های سه بعدی",
            "۳۰۰ هزار تومان جایزه نقدی!"
        ];

        const colors = ["#f59e0b", "#10b981", "#3b82f6", "#8b5cf6", "#ef4444", "#ec4899", "#6366f1", "#14b8a6"];

        const canvas = document.getElementById("wheel");
        const ctx = canvas.getContext("2d");
        const spinBtn = document.getElementById("spinBtn");
        const phoneInput = document.getElementById("phone");
        const resultDiv = document.getElementById("result");
        const prizeSpan = document.getElementById("prize");

        let isSpinning = false;
        const segments = prizes.length;
        const segmentAngle = 360 / segments;

        function drawWheel() {
            ctx.clearRect(0, 0, 300, 300);
            prizes.forEach((prize, i) => {
                const angle = segmentAngle * i * Math.PI / 180;
                ctx.beginPath();
                ctx.moveTo(150, 150);
                ctx.arc(150, 150, 140, angle, angle + segmentAngle * Math.PI / 180);
                ctx.fillStyle = colors[i];
                ctx.fill();
                ctx.strokeStyle = "#fff";
                ctx.lineWidth = 4;
                ctx.stroke();

                ctx.save();
                ctx.translate(150, 150);
                ctx.rotate(angle + segmentAngle * Math.PI / 360);
                ctx.textAlign = "center";
                ctx.fillStyle = "#fff";
                ctx.font = "bold 14px Vazirmatn";
                ctx.shadowColor = "rgba(0,0,0,0.4)";
                ctx.shadowOffsetY = 2;
                ctx.fillText(prize, 80, 10);
                ctx.restore();
            });

            // مرکز گردونه
            ctx.beginPath();
            ctx.arc(150, 150, 30, 0, Math.PI * 2);
            ctx.fillStyle = "#1e293b";
            ctx.fill();
            ctx.strokeStyle = "#fff";
            ctx.lineWidth = 4;
            ctx.stroke();
        }

        function spin() {
            if (isSpinning) return;
            isSpinning = true;
            spinBtn.disabled = true;
            spinBtn.textContent = "در حال چرخش...";

            const randomSpin = Math.floor(Math.random() * 360) + 1440 + 720; // حداقل ۵ دور
            const winnerIndex = Math.floor(((360 - (randomSpin % 360)) % 360) / segmentAngle);

            canvas.style.transform = `rotate(${randomSpin}deg)`;

            setTimeout(() => {
                resultDiv.style.display = "block";
                prizeSpan.textContent = prizes[winnerIndex];
                isSpinning = false;
                spinBtn.textContent = "امروز چرخوندی!";
                spinBtn.disabled = true;

                // کنفتی
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });

                // ذخیره تاریخ امروز برای این شماره
                localStorage.setItem(`spun_${phoneInput.value}`, new Date().toDateString());
            }, 5500);
        }

        function checkCanSpin() {
            const phone = phoneInput.value.trim();
            if (phone.length !== 11 || !phone.startsWith("09")) {
                spinBtn.disabled = true;
                return;
            }

            const lastSpin = localStorage.getItem(`spun_${phone}`);
            const today = new Date().toDateString();

            if (lastSpin === today) {
                spinBtn.textContent = "امروز چرخوندی!";
                spinBtn.disabled = true;
            } else {
                spinBtn.textContent = "چرخاندن گردونه";
                spinBtn.disabled = false;
            }
        }

        phoneInput.addEventListener("input", checkCanSpin);
        spinBtn.addEventListener("click", spin);

        // اولین بار
        drawWheel();
        checkCanSpin();
    </script>
</body>
</html>